<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" layout:decorator="template">

<head>
	<meta charset="UTF-8">
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
		integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css"
		integrity="sha512-Kc323vGBEqzTmouAECnVceyQqyqdsSiqLQISBL29aUW4U/M7pSPA/gEUZQqv1cwx4OnYxTxve5UMg5GT6L4JJg=="
		crossorigin="anonymous" referrerpolicy="no-referrer" />
	<link rel="stylesheet" type="text/css" href="/src/main/resources/static/css/index.css">
	<title>Home</title>
</head>

<body>

	<header>
		<nav class="navbar navbar-expand-lg navbar-light" style="background-color: #243642;">
			<div class="container">
				<!-- Logo và tên thương hiệu -->
				<a class="navbar-brand d-flex align-items-center" href="index.html"> <i
						class="fa-brands fa-strava fa-2x me-2 text-light"></i> <span class="fw-bold text-light">Conan
						Store</span>
				</a>
				<!-- Nút bật/tắt cho thiết bị di động -->
				<button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarContent"
					aria-controls="navbarContent" aria-expanded="false" aria-label="Toggle navigation">
					<span class="navbar-toggler-icon"></span>
				</button>

				<!-- Menu điều hướng -->
				<div class="collapse navbar-collapse" id="navbarContent">
					<!-- Menu chính -->
					<ul class="navbar-nav me-auto mb-2 mb-lg-0">
						<li class="nav-item"><a class="nav-link active text-light" href="index.html">Trang chủ</a>
						</li>
						<li class="nav-item"><a class="nav-link text-light" href="about.html">Về chúng tôi</a></li>
						<li class="nav-item"><a class="nav-link text-light" href="product.html">Sản phẩm</a></li>
						<li class="nav-item"><a class="nav-link text-light" href="contact.html">Liên hệ</a></li>
					</ul>

					<!-- search -->
					<div class="searchbar">
						<div class="searchbar-wrapper">
							<div class="searchbar-left">
								<div class="search-icon-wrapper">
									<span class="search-icon searchbar-icon"> <svg xmlns="http://www.w3.org/2000/svg"
											viewBox="0 0 24 24">
											<path
												d="M15.5 14h-.79l-.28-.27A6.471 6.471 0 0 0 16 9.5 6.5 6.5 0 1 0 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z">
											</path>
										</svg>
									</span>
								</div>
							</div>

							<div class="searchbar-center">
								<div class="searchbar-input-spacer"></div>

								<input type="text" class="searchbar-input" maxlength="2048" name="q"
									autocapitalize="off" autocomplete="off" title="Search" role="combobox"
									placeholder="Search Google">
							</div>

							<div class="searchbar-right">
								<svg class="voice-search" role="button" xmlns="http://www.w3.org/2000/svg"
									viewBox="0 0 24 24">
									<path fill="#4285f4"
										d="m12 15c1.66 0 3-1.31 3-2.97v-7.02c0-1.66-1.34-3.01-3-3.01s-3 1.34-3 3.01v7.02c0 1.66 1.34 2.97 3 2.97z">
									</path>
									<path fill="#34a853" d="m11 18.08h2v3.92h-2z"></path>
									<path fill="#fbbc05"
										d="m7.05 16.87c-1.27-1.33-2.05-2.83-2.05-4.87h2c0 1.45 0.56 2.42 1.47 3.38v0.32l-1.15 1.18z">
									</path>
									<path fill="#ea4335"
										d="m12 16.93a4.97 5.25 0 0 1 -3.54 -1.55l-1.41 1.49c1.26 1.34 3.02 2.13 4.95 2.13 3.87 0 6.99-2.92 6.99-7h-1.99c0 2.92-2.24 4.93-5 4.93z">
									</path>
								</svg>
							</div>
						</div>
					</div>

					<!-- Giỏ hàng và tài khoản người dùng -->
					<ul class="navbar-nav ms-auto mb-2 mb-lg-0">
						<li class="nav-item"><a class="nav-link text-light" href="cart.html"> <i
									class="fa-solid fa-cart-shopping me-2"></i>
							</a></li>
						<li class="nav-item"><a class="nav-link text-light" href="profile.html"> <i
									class="fa-solid fa-user me-2"></i>
								<div id="userInfo"></div>

							</a></li>
						<li class="nav-item"><a class="nav-link text-light" id="logoutBtn" href="login.html"> <i
									class="fa-solid fa-right-from-bracket me-2"></i></a></li>

					</ul>
				</div>
			</div>
		</nav>
	</header>

	<div>

		<div id="carouselExampleControls" class="carousel slide" data-bs-ride="carousel">
			<div class="carousel-inner">
				<div class="carousel-item">
					<img src="https://www.premierpress.com/wp-content/uploads/2019/03/Adidas-Cookies-and-Cream-Website-Banner-Image-with-Fade.jpg"
						class="d-block w-100" style="height: 500px;">
				</div>
				<div class="carousel-item active">
					<img src="https://demo.clipmydeals.com/9/wp-content/uploads/2024/02/adidas_banner-min.jpg"
						class="d-block w-100" style="height: 500px;">
				</div>
				<div class="carousel-item">
					<img src="https://jdesblog.s3.amazonaws.com/wp-content/uploads/2024/08/09_Blog_Header-Banner_Lala_1376x467.jpg"
						class="d-block w-100" style="height: 500px;">
				</div>
			</div>
			<button class="carousel-control-prev" type="button" data-bs-target="#carouselExampleControls"
				data-bs-slide="prev">
				<span class="carousel-control-prev-icon" aria-hidden="true"></span>
				<span class="visually-hidden">Previous</span>
			</button>
			<button class="carousel-control-next" type="button" data-bs-target="#carouselExampleControls"
				data-bs-slide="next">
				<span class="carousel-control-next-icon" aria-hidden="true"></span>
				<span class="visually-hidden">Next</span>
			</button>
		</div>


		<div class="container mb-5">
			<!-- discount -->
			<section class="container my-4">
				<div class="banner text-center py-3">
					<img src="https://blog.jd-sports.com.au/wp-content/uploads/2024/09/Desktop_Top_Banner_1920x840.jpg"
						alt="Khuyến mãi đặc biệt"
						style="width: 100%; max-height: 250px; object-fit: cover; margin-bottom: 1rem;">
					<h2 style="font-size: 2rem; margin-bottom: 0.5rem; color: #31363F;">Khuyến
						mãi đặc biệt</h2>
					<p style="color: #31363F;">Nhận ngay giảm giá lên đến 30% cho
						tất cả các sản phẩm!</p>
					<a href="#" class="btn btn-light text-dark">Xem chi tiết</a>
				</div>
			</section>
			<!-- sản phẩm yêu thích -->


			<div class="container my-5">
				<!-- Tiêu đề danh mục thương hiệu -->
				<h4 class="text-center mb-4">Thương Hiệu</h4>

				<!-- Các sản phẩm -->
				<div class="row item" id="product-list-container">
					<!-- Các thẻ sản phẩm sẽ được chèn vào đây -->
				</div>
				<div id="search-results" class="search-results">

				</div>
			</div>


			<!-- banner -->
			<div class="carousel-inner mb-4">
				<div class="carousel-item active">
					<img src=" https://m.media-amazon.com/images/S/aplus-media-library-service-media/bc5c2006-c77e-4287-9929-6739cb8b7ef2.__CR0,0,1464,600_PT0_SX1464_V1___.jpg"
						class="d-block w-100" alt="..." style="max-height: 400px; object-fit: cover;">
				</div>
			</div>
			<!-- sản phẩm liên quan -->


			<!-- liên hệ - hỗ trợ -->
			<div class="d-flex justify-content-center">
				<div class="col-md-6 mb-4 mx-2">
					<h5 class="fw-bold" style="color: #31363F;">Liên hệ với chúng
						tôi</h5>
					<p>Điền email và nội dung bạn muốn gửi:</p>
					<form action="#" method="POST">
						<div class="mb-3">
							<label for="contactEmail" class="form-label">Email của
								bạn</label> <input type="email" class="form-control" id="contactEmail"
								placeholder="Nhập email của bạn" required>
						</div>
						<div class="mb-3">
							<label for="contactMessage" class="form-label">Nội dung
								tin nhắn</label>
							<textarea class="form-control" id="contactMessage" rows="4"
								placeholder="Nhập nội dung tin nhắn của bạn" required></textarea>
						</div>
						<button type="submit" class="btn btn-dark">Gửi tin nhắn</button>
					</form>
				</div>
				<div class="col-md-6 mb-4 mx-2">
					<img src="https://hires.vn/cdn-cgi/imagedelivery/1m1rJdJLBoJbXbtIvke6Fg/cb194309-3083-4504-ad6e-f40863609c01/public"
						style="width: 650px; border-radius: 20px;">
					<p></p>
				</div>
			</div>
		</div>

	</div>

	<footer th:fragment="footer" class="footer mt-5">
		<div class="container">
			<div class="row">
				<!-- Cột 1: Liên kết nhanh -->
				<div class="footer-col">
					<h4>Liên kết nhanh</h4>
					<ul>
						<li><a href="#">Trang chủ</a></li>
						<li><a href="#">Giới thiệu</a></li>
						<li><a href="#">Sản phẩm</a></li>
						<li><a href="#">Liên hệ</a></li>
					</ul>
				</div>

				<!-- Cột 2: Thông tin liên hệ -->
				<div class="footer-col">
					<h4>Thông tin liên hệ</h4>
					<ul>
						<li><span>Địa chỉ: 123 Đường ABC, Quận Ninh Kiều,
								TP.CanTho</span></li>
						<li><span>Điện thoại: (012) 3456-789</span></li>
						<li><span>Email: abc@gmail.com</span></li>
					</ul>
				</div>

				<!-- Cột 3: Mạng xã hội -->
				<div class="footer-col">
					<h4>Theo dõi chúng tôi</h4>
					<div class="social-links">
						<a href="#"><i class="fab fa-facebook-f"></i></a> <a href="#"><i class="fab fa-twitter"></i></a>
						<a href="#"><i class="fab fa-instagram"></i></a> <a href="#"><i
								class="fab fa-linkedin-in"></i></a>
					</div>
				</div>
			</div>
			<div class="footer-bottom">
				<p>&copy; 2024 Bản quyền thuộc về Công ty ABC. Mọi quyền được bảo
					lưu.</p>
			</div>
		</div>
	</footer>
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
		integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous">

		</script>

	<script>
		function getCookie(name) {
			const value = `; ${document.cookie}`;
			const parts = value.split(`; ${name}=`);
			if (parts.length === 2) return JSON.parse(decodeURIComponent(parts.pop().split(';').shift()));
			return null;
		}

		// Example usage
		const userCookie = getCookie('user');
		if (userCookie) {
			console.log("UserName: " + userCookie.userName); // Get the user name
			console.log("Role: " + userCookie.role); // Get the user role
			console.log("Address: " + userCookie.addresses); // Get user addresses
			console.log("Phone: " + userCookie.phone); // Get user addresses
			console.log("Email: " + userCookie.email); // Get user addresses
			console.log("ID: " + userCookie.id); // Get user addresses
			console.log("Image: " + userCookie.userImage); // Get user addresses
		}



		// Lấy các phần tử cần thiết
		const searchInput = document.querySelector('.searchbar-input');
		const searchResultsContainer = document.getElementById('search-results');
		const productContainer = document.getElementById('product-list-container');

		// Hàm hiển thị tất cả sản phẩm từ API khi không có tìm kiếm
		function loadAllProducts() {
			fetch('http://localhost:8080/api/brands')
				.then(res => res.json())
				.then(brandsWithProducts => {
					console.log("All products from API:", brandsWithProducts);
					productContainer.innerHTML = '';

					brandsWithProducts.forEach(brand => {
						const brandName = brand.brandName;
						const products = brand.productDtos;
						if (!Array.isArray(products) || products.length === 0) return;

						renderBrand(brandName, products);
					});

				})
				.catch(error => console.error('Error fetching product data:', error));
		}

		// Hàm gọi API tìm kiếm
		function searchProducts(keyword) {
			fetch(`http://localhost:8080/api/search?keyword=${keyword}`)
				.then(response => response.json())
				.then(products => {
					searchResultsContainer.innerHTML = '';
					if (products.length === 0) {
						searchResultsContainer.innerHTML = '<p class="text-center">Không tìm thấy sản phẩm nào.</p>';
					} else {
						const productGrid = document.createElement('div');
						productGrid.classList.add('row', 'g-4'); // Sử dụng lớp row và khoảng cách giữa các cột

						products.forEach((product, index) => {
							// Tạo một cột cho mỗi sản phẩm
							const productCol = document.createElement('div');
							productCol.classList.add('col-md-3', 'mb-4'); // 4 sản phẩm trên mỗi hàng (col-md-3)

							// Chèn HTML của sản phẩm vào cột
							productCol.innerHTML = getProductHtml(product);
							productGrid.appendChild(productCol);
						});
						searchResultsContainer.appendChild(productGrid);
					}
				})
				.catch(error => console.error('Error fetching search results:', error));
		}

		// Hàm hiển thị các sản phẩm theo từng thương hiệu
		function renderBrand(brandName, products) {
			const brandSection = document.createElement('div');
			const brandHeading = document.createElement('h6');
			brandHeading.textContent = brandName;
			brandHeading.classList.add('text-center', 'my-3');
			brandSection.appendChild(brandHeading);

			// Thêm d-flex vào phần tử cha để sắp xếp theo hàng ngang
			const productRow = document.createElement('div');
			productRow.classList.add('d-flex', 'flex-wrap', 'gap-3');  // Thêm flex-wrap và gap để sản phẩm không bị chồng lên nhau
			brandSection.appendChild(productRow);

			products.slice(0, 4).forEach(product => {
				const productHtml = getProductHtml(product);
				productRow.insertAdjacentHTML('beforeend', productHtml);
			});

			if (products.length > 4) {
				const showMoreBtn = document.createElement('button');
				showMoreBtn.classList.add('btn', 'btn-outline-secondary', 'my-2');
				showMoreBtn.textContent = 'Xem thêm';
				showMoreBtn.addEventListener('click', () => {
					products.slice(4).forEach(product => {
						const productHtml = getProductHtml(product);
						productRow.insertAdjacentHTML('beforeend', productHtml);
					});
					showMoreBtn.remove();
				});
				brandSection.appendChild(showMoreBtn);
			}

			productContainer.appendChild(brandSection);


		}



		// Hàm tạo HTML cho sản phẩm
		function getProductHtml(product) {
			return `
				<div class="d-flex" style="flex-wrap: wrap; gap: 15px;">
					<div class="product-card text-center position-relative" style="width: 300px;">
						<img src="${product.image}" class="product-img" alt="Product Image" loading="lazy">
						<div class="product-info">
							<h6 class="product-name">${product.name}</h6>
							<div class="hover-content">
								<a href="product_detail.html?id=${product.id}" class="btn btn-outline-dark mb-2">Xem chi tiết</a>
								<!-- Nút yêu thích, sử dụng đúng product.id -->
								<button class="btn btn-outline-dark btn-add-to-favorite" data-product-id="${product.id}" onclick="addToFavorites(${product.id})">Thêm vào yêu thích</button>
							</div>
						</div>
					</div>
				</div>
				`;
		}


		// Lắng nghe sự kiện nhập trên ô tìm kiếm
		searchInput.addEventListener('keyup', function () {
			const keyword = searchInput.value.trim();

			if (keyword) {
				productContainer.style.display = 'none'; // Ẩn tất cả sản phẩm
				searchResultsContainer.style.display = 'block'; // Hiển thị vùng kết quả tìm kiếm
				searchProducts(keyword); // Gọi API tìm kiếm
			} else {
				searchResultsContainer.innerHTML = ''; // Xóa kết quả tìm kiếm
				productContainer.style.display = 'block'; // Hiển thị lại tất cả sản phẩm
				loadAllProducts(); // Gọi lại API để tải toàn bộ sản phẩm
			}
		});

		// Tải tất cả sản phẩm khi trang load lần đầu
		loadAllProducts();




		// Hàm gọi API để thêm sản phẩm vào yêu thích
		function addToFavorites(productId) {
			const userCookie = getCookie('user');  // Giả sử cookie lưu thông tin người dùng

			if (userCookie && userCookie.id) {  // Kiểm tra nếu có accountId trong cookie
				const accountId = userCookie.id;  // Lấy accountId từ cookie

				// Gửi yêu cầu đến backend để thêm sản phẩm vào yêu thích
				fetch(`http://localhost:8080/api/favorites/add?accountId=${accountId}&productId=${productId}`, {
					method: 'POST',
				})
					.then(response => response.json())
					.then(data => {
						alert("Sản phẩm đã được thêm vào yêu thích.");
						console.log(data);  // Bạn có thể hiển thị thêm thông tin nếu cần
					})
					.catch(error => {
						alert("Lỗi kết nối với server: " + error.message);
					});
			} else {
				alert("Vui lòng đăng nhập trước khi thêm sản phẩm vào yêu thích.");
			}
		}
	</script>



</body>

</html>